<mat-form-field appearance="fill">
  <mat-label>å…¨åŸŸæœå°‹</mat-label>
  <input matInput (keyup)="applyFilter($event)" placeholder="0050">
</mat-form-field>

<mat-form-field>
  <mat-label>åŸºæœ¬é¢</mat-label>
  <mat-select [(value)]="selected" (valueChange)="changeDisplayedColumns($event)">
    @for (menu of menu_items_basic; track menu) {
    <mat-option [value]="menu.value">{{menu.viewValue}}</mat-option>
    }
  </mat-select>
</mat-form-field>
<mat-form-field>
  <mat-label>äº¤æ˜“ç‹€æ³</mat-label>
  <mat-select [(value)]="selected" (valueChange)="changeDisplayedColumns($event)">
    @for (menu of menu_items_transaction; track menu) {
    <mat-option [value]="menu.value">{{menu.viewValue}}</mat-option>
    }
  </mat-select>
</mat-form-field>

<table mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)"
  class="mat-elevation-z8">

  <!-- Checkbox Column -->
  <ng-container matColumnDef="select">
    <th mat-header-cell *matHeaderCellDef>
      <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="isAllSelected()"
        [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
      </mat-checkbox>
    </th>
    <td mat-cell *matCellDef="let row">
      <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
        [checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)">
      </mat-checkbox>
    </td>
  </ng-container>

  <!-- ğŸ¢å…¬å¸åŸºæœ¬è³‡æ–™ Start -------------------------------------------------- -->
  <!-- 1. Column -->
  <ng-container matColumnDef="b_info_code">
    <th mat-header-cell *matHeaderCellDef mat-sort-header class="sticky-column">
      <b>ä»£è™Ÿ</b>
    </th>
    <td mat-cell *matCellDef="let element" class="sticky-column"> <a target="_blank"
        href="https://histock.tw/stock/{{element.b_info_code}}">{{element.b_info_code}}</a> </td>
  </ng-container>

  <!-- 2. Column -->
  <ng-container matColumnDef="b_info_name">
    <th mat-header-cell *matHeaderCellDef mat-sort-header class="sticky-column">
      <b>åç¨±</b>
    </th>
    <td mat-cell *matCellDef="let element" class="sticky-column"> <a target="_blank"
        href="https://www.cmoney.tw/follow/channel/stock-{{element.b_info_code}}">{{element.b_info_name}}</a> </td>
  </ng-container>

  <!-- 3. Column -->
  <ng-container matColumnDef="b_info_market">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>å¸‚å ´</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_market}} </td>
  </ng-container>

  <!-- 4. Column -->
  <ng-container matColumnDef="b_info_date">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>æ—¥æœŸ</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_date}} </td>
  </ng-container>

  <!-- 5. Column -->
  <ng-container matColumnDef="b_info_price">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>æˆäº¤åƒ¹</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngStyle]="{color: element.b_info_pct>=0 ? 'red' :'green'}">
      {{element.b_info_price}} </td>
  </ng-container>

  <!-- 1. Column -->
  <ng-container matColumnDef="b_info_change">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>æ¼²è·Œåƒ¹</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngStyle]="{color: element.b_info_pct>=0 ? 'red' :'green'}">
      {{element.b_info_change}}
    </td>
  </ng-container>

  <!-- 2. Column -->
  <ng-container matColumnDef="b_info_pct">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>æ¼²è·Œå¹…</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngStyle]="{color: element.b_info_pct>=0 ? 'red' :'green'}">
      {{element.b_info_pct}} </td>
  </ng-container>

  <!-- 3. Column -->
  <ng-container matColumnDef="b_info_face">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>é¢å€¼(å…ƒ)</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_face}} </td>
  </ng-container>

  <!-- 4. Column -->
  <ng-container matColumnDef="b_info_capital">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>è‚¡æœ¬(å„„)</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_capital}} </td>
  </ng-container>

  <!-- 5. Column -->
  <ng-container matColumnDef="b_info_count">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ç™¼è¡Œé‡(è¬å¼µ)</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_count}} </td>
  </ng-container>

  <!-- 1. Column -->
  <ng-container matColumnDef="b_info_market_cap">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>å¸‚å€¼(å„„)</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_market_cap}} </td>
  </ng-container>

  <!-- 2. Column -->
  <ng-container matColumnDef="b_info_up_year">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>æˆç«‹å¹´æ•¸</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_up_year}} </td>
  </ng-container>

  <!-- 3. Column -->
  <ng-container matColumnDef="b_info_market_year">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ä¸Šå¸‚å¹´æ•¸</b>
    </th>
    <td mat-cell *matCellDef="let element"
      [ngClass]="{'highlight': isHighlight_more_than(10, element.b_info_market_year)}">
      {{element.b_info_market_year}}
    </td>
  </ng-container>

  <!-- 4. Column -->
  <ng-container matColumnDef="b_info_futures">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>è‚¡ç¥¨æœŸè²¨</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_futures}} </td>
  </ng-container>

  <!-- 5. Column -->
  <ng-container matColumnDef="b_info_options">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>é¸æ“‡æ¬Š</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_options}} </td>
  </ng-container>

  <!-- 1. Column -->
  <ng-container matColumnDef="b_info_Warrant">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>æ¬Šè­‰</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_Warrant}} </td>
  </ng-container>

  <!-- 2. Column -->
  <ng-container matColumnDef="b_info_debt">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>å…¬å¸å‚µ</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_debt}} </td>
  </ng-container>

  <!-- 3. Column -->
  <ng-container matColumnDef="b_info_private">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ç§å‹Ÿè‚¡</b>
    </th>
    <td mat-cell *matCellDef="let element">
      {{element.b_info_private}}
    </td>
  </ng-container>

  <!-- 4. Column -->
  <ng-container matColumnDef="b_info_special">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ç‰¹åˆ¥è‚¡</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_special}} </td>
  </ng-container>

  <!-- 5. Column -->
  <ng-container matColumnDef="b_info_verticals">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ç”¢æ¥­åˆ¥</b>
    </th>
    <td mat-cell *matCellDef="let element"> <a target="_blank"
        href="https://stock.cnyes.com/market/TWS:{{element.b_info_code}}:STOCK">{{element.b_info_verticals}}</a> </td>
  </ng-container>

  <!-- 1. Column -->
  <ng-container matColumnDef="b_info_chairman">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>è‘£äº‹é•·</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_chairman}} </td>
  </ng-container>

  <!-- 2. Column -->
  <ng-container matColumnDef="b_info_manager">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ç¸½ç¶“ç†</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element.b_info_manager}} </td>
  </ng-container>
  <!-- ğŸ¢å…¬å¸åŸºæœ¬è³‡æ–™ End ---------------------------------------------------- -->

  <!-- ğŸ“ˆæˆ‘çš„åŸºæœ¬é¢ Start ---------------------------------------------------- -->
  <!-- 1. Column -->
  <ng-container *ngFor="let col of columnStr_m_basic let idx=index" [matColumnDef]="col.key">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>{{col.value}}</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element[col.key]}} </td>
  </ng-container>

  <ng-container matColumnDef="m_basic_epsp">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>EPSä¼°åƒ¹</b>
    </th>
    <td mat-cell *matCellDef="let element"
      [ngClass]="{'highlight': isHighlight_less_than(element.m_basic_epsp, element.b_info_price)}">
      {{element.m_basic_epsp}}
    </td>
  </ng-container>
  <ng-container matColumnDef="m_basic_yiep">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>è‚¡åƒ¹æ·¨å€¼æ¯”</b>
    </th>
    <td mat-cell *matCellDef="let element"
      [ngClass]="{'highlight': isHighlight_less_than(element.m_basic_yiep, element.b_info_price)}">
      {{element.m_basic_yiep}}
    </td>
  </ng-container>
  <ng-container matColumnDef="m_basic_tper">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ç¸½å ±é…¬æœ¬ç›Šæ¯”</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight_more_than(1, element.m_basic_tper)}">
      {{element.m_basic_tper}}
    </td>
  </ng-container>
  <ng-container matColumnDef="m_basic_cheap">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ä¾¿å®œåº¦</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight_more_than(1, element.m_basic_cheap)}">
      {{element.m_basic_cheap}}
    </td>
  </ng-container>
  <ng-container matColumnDef="m_basic_kp">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ROEä¼°åƒ¹</b>
    </th>
    <td mat-cell *matCellDef="let element"
      [ngClass]="{'highlight': isHighlight_less_than(element.m_basic_kp, element.b_info_price)}">
      {{element.m_basic_kp}}
    </td>
  </ng-container>
  <ng-container matColumnDef="m_basic_pbr">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>è‚¡åƒ¹æ·¨å€¼æ¯”</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight(0,1, element.m_basic_pbr)}">
      {{element.m_basic_pbr}}
    </td>
  </ng-container>
  <ng-container matColumnDef="m_basic_peg">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>PEG</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight(0,999, element.m_basic_peg)}">
      {{element.m_basic_peg}}
    </td>
  </ng-container>
  <ng-container matColumnDef="m_basic_cash_y">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ç¾é‡‘æ®–åˆ©ç‡</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight(5,999, element.m_basic_cash_y)}">
      <b>{{element.m_basic_cash_y}}</b>
    </td>
  </ng-container>
  <ng-container matColumnDef="m_basic_roe">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>å¹³å‡ROE (>8%)</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight(8,999, element.m_basic_roe)}">
      {{element.m_basic_roe}}
    </td>
  </ng-container>
  <!-- ğŸ“ˆæˆ‘çš„åŸºæœ¬é¢ End ------------------------------------------------------ -->

  <!-- ğŸŸè‚¡é­šåŸºæœ¬é¢  Start --------------------------------------------------- -->
  <!-- 1. Column -->
  <ng-container *ngFor="let col of columnStr_e_fish let idx=index" [matColumnDef]="col.key">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>{{col.value}}</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element[col.key]}} </td>
  </ng-container>
  <!-- 1. Column -->
  <ng-container matColumnDef="e_fish_roe">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>å¹³å‡ROE (>8%)</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight_more_than(8, element.e_fish_roe)}">
      {{element.e_fish_roe}}
    </td>
  </ng-container>
  <!-- 2. Column -->
  <ng-container matColumnDef="e_fish_iir">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>æœ¬æ¥­æ”¶å…¥ç‡ (>80%)</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight_more_than(80, element.e_fish_iir)}">
      {{element.e_fish_iir}}
    </td>
  </ng-container>
  <!-- 3. Column -->
  <ng-container matColumnDef="e_fish_debt">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>å¹³å‡è² å‚µç¸½é¡ (<60%) </b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight_less_than(60, element.e_fish_debt)}">
      {{element.e_fish_debt}}
    </td>
  </ng-container>
  <!-- 4. Column -->
  <ng-container matColumnDef="e_fish_cash">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ç‡Ÿé‹ç¾é‡‘æµé‡ (>0å„„)</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight_more_than(0, element.e_fish_cash)}">
      {{element.e_fish_cash}}
    </td>
  </ng-container>
  <!-- 4. Column -->
  <ng-container matColumnDef="e_fish_opm">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>ç‡Ÿç›Šç‡ (>0%)</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'highlight': isHighlight_more_than(0, element.e_fish_opm)}">
      {{element.e_fish_opm}}
    </td>
  </ng-container>
  <!-- ğŸŸè‚¡é­šåŸºæœ¬é¢  End ----------------------------------------------------- -->

  <!-- ğŸ’°äº¤æ˜“ç‹€æ³_è¿‘12æ—¥æ¼²è·Œå¹…  Start -------------------------------------------->
  <!-- 1. Column -->
  <ng-container *ngFor="let col of columnStr_p_dpct let idx=index" [matColumnDef]="col.key">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>{{col.value}}</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element[col.key]}} </td>
  </ng-container>
  <!-- ğŸ’°äº¤æ˜“ç‹€æ³_è¿‘12æ—¥æ¼²è·Œå¹…  End ---------------------------------------------->

  <!-- ğŸ’¹EPSæˆé•·  Start ----------------------------------------------------- -->
  <!-- 1. Column -->
  <ng-container *ngFor="let col of columnStr_e_icr let idx=index" [matColumnDef]="col.key">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>{{col.value}}</b>
    </th>
    <td mat-cell *matCellDef="let element"> {{element[col.key]}} </td>
  </ng-container>
  <!-- 1. Column -->
  <ng-container matColumnDef="e_icr_ytotalCount">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>12å¹´ç¸½è©•åˆ†</b>
    </th>
    <td mat-cell *matCellDef="let element"
      [ngClass]="{'highlight': isHighlight_more_than(10, element.e_icr_ytotalCount)}">
      <b>{{element.e_icr_ytotalCount}}</b>
    </td>
  </ng-container>
  <!-- 2. Column -->
  <ng-container matColumnDef="e_icr_totalCount">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>è¿‘æœŸç¸½è©•åˆ†</b>
    </th>
    <td mat-cell *matCellDef="let element"
      [ngClass]="{'highlight': isHighlight_more_than(13, element.e_icr_totalCount)}">
      <b>{{element.e_icr_totalCount}}</b>
    </td>
  </ng-container>
  <!-- ğŸ’¹EPSæˆé•·  End ------------------------------------------------------- -->

  <!-- ğŸ’·æˆ‘çš„EPS  Start ----------------------------------------------------- -->
  <!-- 1. Column -->
  <ng-container *ngFor="let col of columnStr_m_eps let idx=index" [matColumnDef]="col.key">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>
      <b>{{col.value}}</b>
    </th>
    <td mat-cell *matCellDef="let element" [ngClass]="{'hl_eps_2': hl_my_eps(element[col.key])==2, 
      'hl_eps_3': hl_my_eps(element[col.key])==3,
      'hl_eps_4': hl_my_eps(element[col.key])==4,
      'hl_eps_5': hl_my_eps(element[col.key])==5}">
      {{element[col.key]}} </td>
  </ng-container>
  <!-- ğŸ’·æˆ‘çš„EPS  End ------------------------------------------------------- -->

  <tr mat-header-row *matHeaderRowDef="displayedColumns" class="sticky-header"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns;"
    [ngClass]="{'highlight_up': isHighlighted(row)==1, 'highlight_down': isHighlighted(row)==-1}"></tr>
</table>
<mat-paginator [pageSizeOptions]="[5, 10, 20]" [pageSize]="10" showFirstLastButtons
  aria-label="Select page of periodic elements">
</mat-paginator>

<button mat-button (click)="selectedRows = getSelectedRows()">Show Selected Rows</button>
<div *ngIf="selectedRows && selectedRows.length">
  <h3>Selected Rows:</h3>
  <ul>
    <li *ngFor="let row of selectedRows">
      {{ row.b_info_code }} - {{ row.b_info_name }} - {{ row.b_info_price }} - {{ row.b_info_change }}
    </li>
  </ul>
</div>
